# BOARDING - ë¹„í–‰ê¸°ì— íƒ‘ìŠ¹í•˜ëŠ” ìˆœê°„ì˜ ì„¤ë ˆì„ <img src="https://github.com/user-attachments/assets/01dce807-9d6b-4f9b-8adf-c17781570813" width="30" height="30">
> The Beginning of a New Journey
<br>
<br>

<div align="center">
  <img src="https://github.com/user-attachments/assets/01dce807-9d6b-4f9b-8adf-c17781570813" width="150" height="150">
  <br>
  <br>
  <img src="https://img.shields.io/badge/Swift-v5.9.2-red?logo=swift"/>
  <img src="https://img.shields.io/badge/Xcode-v15.1-blue?logo=Xcode"/>
  <img src="https://img.shields.io/badge/iOS-16.0+-black?logo=apple"/>  
  <br>
  <br>
  <a href="https://apps.apple.com/kr/app/boarding/id6473780848" style="display: inline-block; overflow: hidden; border-radius: 13px; width: 180px; height: 83px;"><img src="https://tools.applemediaservices.com/api/badges/download-on-the-app-store/black/en-US?size=250x83&amp" alt="Download on the App Store" style="border-radius: 13px; width: 180px; height: 83px;"></a>
</div>

<div align="center">
  <br>
  <img src="https://github.com/user-attachments/assets/556a7f72-782c-4d66-bc3c-d5691fea3904" width="19%"> <img src="https://github.com/user-attachments/assets/b10ab8fb-cf6c-45b2-8b73-bb8d89e7146c" width="19%"> <img src="https://github.com/user-attachments/assets/b4912550-3f3b-4dd4-9e1d-536045006fab" width="19%"> <img src="https://github.com/user-attachments/assets/ebfaad22-9d4d-4780-b85b-9d1ba50bcc04" width="19%"> <img src="https://github.com/user-attachments/assets/4a262d08-bef0-490d-bf49-736337bfe756" width="19%">
</div>
<br>

## í”„ë¡œì íŠ¸ ì†Œê°œ
`ğŸ›©ï¸ ì²˜ìŒ ì—¬í–‰ì„ ì¤€ë¹„í•˜ê³  ë¹„í–‰ê¸° íƒ‘ìŠ¹ì„ ê¸°ë‹¤ë¦¬ë˜ ê·¸ ë•Œì˜ ì„¤ë ˆì„ì„ ê¸°ì–µí•˜ì‹œë‚˜ìš”?`
> ì‚¬ìš©ìë“¤ì´ ê¸°ë¡í•œ ê²Œì‹œë¬¼ë“¤ì„ ìŠ¤í¬ë©í•´ì„œ **ë‚˜ë§Œì˜ í”Œëœê³¼ ì¼ì •**ì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì»¤ë®¤ë‹ˆí‹° ì•± ì„œë¹„ìŠ¤
<br>

## í”„ë¡œì íŠ¸ ì£¼ìš” ê¸°ëŠ¥
- **ì¹´ì¹´ì˜¤í†¡, ì• í”Œ** ê°„í¸ë¡œê·¸ì¸ ê¸°ëŠ¥
- í™ˆ íƒ­ ë‚´ ìœ ì € ê²Œì‹œë¬¼ **ì¢‹ì•„ìš”, ëŒ“ê¸€, ìŠ¤í¬ë©** ê¸°ëŠ¥
- ë™ì˜ìƒ, ì‚¬ì§„ í˜•ì‹ì˜ ê²Œì‹œë¬¼ ì—…ë¡œë“œ ê°€ëŠ¥, **Google Map ì¥ì†Œ ë°ì´í„°**ì™€ ì—°ë™
- í”Œë¦½ ì¸í„°ë ‰ì…˜ì´ ê°€ëŠ¥í•œ ì¹´ë“œ í˜•íƒœë¡œë„ ì‚´í´ë³¼ ìˆ˜ ìˆëŠ” ê²Œì‹œê¸€
- ìŠ¤í¬ë©í•œ ê²Œì‹œê¸€ì„ ë©”ëª¨ì™€ í•¨ê»˜ **ë‚´ ì—¬í–‰í”Œëœ**, **ë‚´ ì—¬í–‰ì¼ì •**ì— ì¶”ê°€ ê°€ëŠ¥
- **ë‚´ê°€ ì“´ ê¸€, ë§ˆì¼ë¦¬ì§€, ì—¬í–‰ ë ˆë²¨, ì°¨ë‹¨ ìœ ì € ê´€ë¦¬** ê¸°ëŠ¥
<br>

## í”„ë¡œì íŠ¸ ê°œë°œ í™˜ê²½
- ê°œë°œ ì¸ì›
  - ë””ìì´ë„ˆ 1ëª…, iOSê°œë°œ 1ëª…
- ê°œë°œ ê¸°ê°„
  - 2023.09 - 2024.01 (4ê°œì›”)
- iOS ìµœì†Œ ë²„ì „
  - iOS 16.0+
<br>

## í”„ë¡œì íŠ¸ ê¸°ìˆ  ìŠ¤íƒ
- **í™œìš©ê¸°ìˆ  ë° í‚¤ì›Œë“œ**
  - **iOS** : swift 5.9.2, xcode 15.1, UIKit, Photos, Apple Authorization
  - **Network** : RxSwift, Firebase, Kakao API
  - **UI** : CodeBaseUI, Snapkit, Then

- **ë¼ì´ë¸ŒëŸ¬ë¦¬**

ë¼ì´ë¸ŒëŸ¬ë¦¬ | ì‚¬ìš© ëª©ì  | Version
:---------:|:----------:|:---------:
GoogleMap | ì¥ì†Œ ì„¸ë¶€ ì •ë³´ | 8.3.1
FSCalendar | í”Œëœ, ì¼ì • ë‚ ì§œ ì„ íƒ  | 2.8.4
Kingfisher | ì´ë¯¸ì§€ ì²˜ë¦¬ | 7.0
FirebaseStorageUI | ì €ì¥ì†Œ ì´ë¯¸ì§€ ì²˜ë¦¬ | -
<br>

## í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜
<div align="center">
  <img src="https://github.com/user-attachments/assets/3e697e84-2395-4c91-a4b0-5a31cb54a5b5">
</div>
<br>

> RxSwift + MVVM Architecture
- SnapKitê³¼ Thenì„ í™œìš©í•œ CodeBase UIë¡œ ìƒì‚°ì„±ì„ ë†’ì´ê³ , ë°˜ë³µë˜ëŠ” UIìš”ì†Œë“¤ì— ëŒ€í•œ Viewì˜ ì¬ì‚¬ìš©ì„±ì„ ë†’ì„
- Photosë¥¼ í†µí•´ ê°€ì ¸ì˜¨ ìœ ì € ì‚¬ì§„ ë°ì´í„°ì˜ ë¶€ì¡±í•œ ì •ë³´ë“¤ì„ Google Map ì¥ì†Œë°ì´í„°ì™€ ì—°ë™í•˜ì—¬ Storageì— ì €ì¥
- Kakao Authì™€ Apple Authë¥¼ ë‹´ë‹¹í•˜ëŠ” ëª¨ë¸ë“¤ì´ Firebase Auth ë°ì´í„°ì™€ ì—°ë™ë˜ì–´ í†µí•© Tokenìœ¼ë¡œ ìœ ì € ë¡œê·¸ì¸ ìƒíƒœ ê´€ë¦¬
<br>

## íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
### 1. Firebase ê¸°ë°˜ ì• í”Œë¡œê·¸ì¸ì˜ 'íšŒì›íƒˆí‡´'ë¥¼ êµ¬í˜„í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œ
> Firebaseë‚´ì— êµ¬í˜„ëœ revokeToken ë©”ì†Œë“œëŠ” Firebaseë‚´ì—ì„œì˜ tokenë§Œ ë‹¤ë£° ë¿ì´ì§€, ì• í”Œë¡œê·¸ì¸ í† í° ìì²´ì˜ ì—°ê²° í•´ì œê¹Œì§€ëŠ” í•  ìˆ˜ ì—†ì—ˆë‹¤.
<div align="center">
  <img src="https://github.com/user-attachments/assets/91c8f3da-3662-426e-aeed-3010382240bd" width="75%"> <img src="https://github.com/user-attachments/assets/aaf1deb0-4a40-4c57-a47e-6a5369855a68" width="11.8%"> <img src="https://github.com/user-attachments/assets/2fc5269a-5b76-4824-a878-66ee90272871" width="11.8%"> 
</div>
<br>

- appleì—ê²Œ Rest API Callì„ ë³´ë‚´ì„œ revokeì— í•„ìš”í•œ refresh Tokenì„ ê°€ì ¸ì˜¨ë‹¤. ì´ ê³¼ì •ì—ì„œ **JWT(JsonWebToken)ìƒì„±**ì´ í•„ìš”
- JWTë¥¼ í´ë¼ì´ì–¸íŠ¸ë‹¨ì—ì„œ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ë³´ì•ˆ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, **Firebase Cloud Function**ì„ ì‚¬ìš©í•´ì„œ ì„œë²„ë¦¬ìŠ¤ ë°±ì—”ë“œ ê¸°ëŠ¥ì„ ì‚¬ìš©
- SignInì„ í•˜ëŠ” ê³¼ì •ì—ì„œ ë°›ì•„ì˜¨ Refresh Tokenì„ **UserDefaults**ì— ì €ì¥í•œ ë‹¤ìŒ, íšŒì› íƒˆí‡´ revoke Tokenì‹œì ì—ì„œ ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” í˜•íƒœë¡œ ë¬¸ì œ í•´ê²°
> Sign In
```swift
let credential = OAuthProvider.appleCredential(withIDToken: tokenString, rawNonce: nonce, fullName: appleIDCredential.fullName)

if let code = appleIDCredential.authorizationCode, let codeString = String(data: code, encoding: .utf8) {
    //Use FireBase Cloud Function
    let url = URL(string: "https://us-central1-boarding-ef2f1.cloudfunctions.net/getRefreshToken?code=\(codeString)".addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "https://apple.com")!
    let task = URLSession.shared.dataTask(with: url) {(data, response, error) in
        if let data = data {
            //Get Refresh Token
            let refreshToken = String(data: data, encoding: .utf8) ?? ""
            //Save in UserDefaults
            UserDefaults.standard.set(refreshToken, forKey: "refreshToken")
        }
    }
    task.resume()
}

//Sign In with Credential
Auth.auth().signIn(with: credential) { ... }
```
> Withdraw
```swift
let credential = OAuthProvider.credential(withProviderID: "apple.com", idToken: tokenString, rawNonce: nonce)

//Use Refresh Token Saved in UserDefaults
let token = UserDefaults.standard.string(forKey: "refreshToken")
if let token = token {
    //Revoke Token
    let url = URL(string: "https://us-central1-boarding-ef2f1.cloudfunctions.net/revokeToken?refresh_token=\(token)".addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "https://apple.com")!
    let task = URLSession.shared.dataTask(with: url) {(data, response, error) in
        guard data != nil else { return }
    }
    task.resume()
}

//Sign Out in FireBase
Auth.auth().signOut() { ... }
```
<br>

### 2. ì„¸ ê°œì˜ User Interactionì´ ê²¹ì¹˜ëŠ” Sticky Header View
> Sticky Header Viewì™€ Page View Controller, ê·¸ë¦¬ê³  ê·¸ ì•ˆì— Scroll Viewë“¤ì´ ë³‘ìš©ë˜ì–´ì•¼ í•˜ëŠ” ìƒí™©
<div align="center">
  <img src="https://github.com/user-attachments/assets/294c340e-e5ea-4637-84bb-3b295910d154" width="75%"> <img src="https://github.com/user-attachments/assets/bf090cc9-5918-4f50-8db5-c829fa26faff" width="11.8%"> <img src="https://github.com/user-attachments/assets/07fe762e-4e2e-470a-b0d6-6554e0096daa" width="11.8%"> 
</div>
<br>

- Pan Gestureì˜ stateì— ë”°ë¥¸ translationê³¼ velocityë¡œ **Sticky Header View**ë¥¼ ìš°ì„ ì ìœ¼ë¡œ êµ¬í˜„ (ì´ ë•Œ yê°’ë§Œì„ ì‚¬ìš©í•˜ì—¬ Page View Controllerì˜ interactionê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì„¤ì •) 
- Page Listë§ˆë‹¤ RxSwiftì˜ **BehaviorRelay**ë¥¼ ì •ì˜í•˜ì—¬ Sticky Header Viewì˜ UI ìƒíƒœë¥¼ Observe í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
- BehaviorRelayë¥¼ View.isScrollEnabledì˜ ê°’ê³¼ **bind**í•˜ì—¬ Pan Gestureì˜ ìš°ì„ ìˆœìœ„ë¥¼ ëª…ì‹œí•˜ì—¬ ì¸í„°ë ‰ì…˜ì„ êµ¬í˜„
> Sticky Header View
```swift
@objc func addModalMotion(_ recognizer: UIPanGestureRecognizer) {
    let minY = window.safeAreaInsets.top
    let maxY = self.maxY
    
    switch recognizer.state {
        
    case .began, .changed:
        //Set Translation
        let translation = recognizer.translation(in: modalView)
        //Set max, min Bound
        let y = min(maxY, max(minY, modalView.frame.minY + translation.y))
        //Change Top Constraints
        modalView.snp.updateConstraints { make in
            make.top.equalToSuperview().offset(y)
        }
        recognizer.setTranslation(CGPoint.zero, in: self.view)
        
    case .ended:
        //Direction of Pin Gesture
        let velocity = recognizer.velocity(in: modalView).y
        let shouldClose = velocity > 0
        //Auto Animation
        UIView.animate(withDuration: 0.3, delay: 0, options: .curveEaseOut, animations: {
            self.modalView.snp.updateConstraints { make in
                make.top.equalToSuperview().offset(shouldClose ? maxY : minY)
            }
            self.view.layoutIfNeeded()
        }, completion: nil)
        
        //Set BehaviorRelay to Each PageList
        modalPageViewController.pageList.forEach { vc in
            switch vc {
            case is NFTViewController:
                if let vc = vc as? NFTViewController {
                    vc.modalClosed.accept(shouldClose)
                }
            case is MILEViewController:
                if let vc = vc as? MILEViewController {
                    vc.modalClosed.accept(shouldClose)
                }
            default:
                if let vc = vc as? ExpertLevelViewController {
                    vc.modalClosed.accept(shouldClose)
                }
            }
        }
    default:
        break
    }
}
```
> Scroll View
```swift
//Set Default Value True
let modalClosed = BehaviorRelay<Bool>(value: true)

func setRx() {
    //Bind to ScrollView
    modalClosed
        .bind(with: self) { owner, isClosed in
            owner.ScrollView.isScrollEnabled = isClosed
        }
        .disposed(by: disposeBag)
}
```
<br>

### 3. FireStore Plan ë¬¸ì„œ ì €ì¥ì—ì„œ ìˆœì„œ ë°”ê¾¸ê¸°, ì‚­ì œëœ ê²Œì‹œê¸€ ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ë¬¸ì œ
> Plan ë¬¸ì„œì— ê²Œì‹œê¸€ ì •ë³´ë¥¼ ë³µì‚¬í•´ì„œ ëª¨ë‘ ì €ì¥í•˜ë‹¤ë³´ë‹ˆ, ë¹ ë¥´ê²Œ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ëŠ” í”Œëœ ìˆœì„œ ë°”ê¾¸ê¸°ì™€ ìœ ì €ì˜ ê²Œì‹œê¸€ ì‚­ì œ ìœ ë¬´ íƒìƒ‰ì˜ ì†ë„ ë¬¸ì œê°€ ìˆì—ˆë‹¤.
<div align="center">
  <img src="https://github.com/user-attachments/assets/fa1ee40a-a255-415c-90f2-bb95449cf9d3" width="75%"> <img src="https://github.com/user-attachments/assets/2256ca9e-4579-4121-b400-8fcec2f01c58" width="11.8%"> <img src="https://github.com/user-attachments/assets/77e2538c-854a-4ec5-8698-151643588a05" width="11.8%"> 
</div>
<br>

- í•„ìš”í•œ ê°ì²´ì˜ ë³µì‚¬ ê¸°ë°˜ ì €ì¥ì—ì„œ Card ë¬¸ì„œì˜ IDê°’ì„ ì €ì¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½
- IDê°’ì´ ë§ëŠ” Cardë¥¼ ì°¾ê¸° ìœ„í•´ ëª¨ë“  Cardë¬¸ì„œë¥¼ ìˆœíšŒí•´ì•¼ í•˜ëŠ” ë¬¸ì œê°€ ìˆìœ¼ë¯€ë¡œ, ì´ëŠ” **Firestore Custom ìƒ‰ì¸**ì„ ìƒì„±í•˜ì—¬ ìµœì í™”
> Scrap ì¶”ê°€
```swift
func addScrap(planID: String, CardID: String) {
    db.collection("User").document(userUid).collection("Plan").document(planID).updateData(["scrap": FieldValue.arrayUnion([CardID])]) { error in
        if let error = error {
            print("scrap ì¶”ê°€ ì—ëŸ¬: \(error)")
        } else {
            print("scrap ì¶”ê°€ ì„±ê³µ")
            self.addScrapSubject.onNext(())
        }
    }
}
```
> Planì— ì‚­ì œëœ Card í¬í•¨ì‹œ Index ì •ë¦¬
```swift
//ì‚­ì œëœ Card í¬í•¨ë˜ì–´ìˆì„ ë•Œ dayPlanì—ì„œ ì‚­ì œ
for (index, item) in items.enumerated() where item.CardID == "" {
    let memoArray = dayMemoArray.enumerated().filter { $0.offset != index }.map { $0.element }
    self.removeDayPlan(day: day, CardID: dayArray[index], memoArray: memoArray)
}
items.removeAll { $0.CardID == "" }
```
